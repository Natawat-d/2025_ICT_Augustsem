<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ICT Aug2025</title>
    <!-- Tailwind CSS CDN for modern styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts - Inter for a clean, modern look -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        /* Apply Inter font family to the body */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6; /* Light gray background */
        }
        /* Container for the timetable to enable horizontal scrolling on smaller screens */
        .timetable-container {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch; /* Smoother scrolling for iOS devices */
            max-width: 100vw; /* Ensure it doesn't overflow the viewport */
        }
        /* Table styling for better readability and structure */
        table {
            width: 100%;
            min-width: 1200px; /* Minimum width to ensure all time slots are visible */
            border-collapse: separate; /* Allows for rounded corners on cells if needed */
            border-spacing: 0; /* No space between table cells */
        }
        /* General cell padding and alignment */
        th, td {
            padding: 8px;
            text-align: left;
            vertical-align: top;
            white-space: normal; /* Allow text to wrap within cells */
        }
        /* Header row styling */
        th {
            background-color: #e5e7eb; /* Light gray background for headers */
            position: sticky; /* Make headers sticky for horizontal scrolling */
            top: 0; /* Stick to the top of the container */
            z-index: 20; /* Ensure headers are above other content when scrolling */
        }
        /* Sticky day column styling */
        td.sticky {
            position: sticky;
            left: 0; /* Stick to the left of the container */
            background-color: #ffffff; /* White background to stand out */
            z-index: 10; /* Ensure day column is above time cells when scrolling */
        }
        /* Adjust column width for time slots to ensure consistent sizing */
        .time-slot-header, .time-slot-cell {
            min-width: 90px; /* Minimum width for each 30-minute time slot */
        }
        /* Styling for individual class entries within a cell */
        .class-entry {
            border-radius: 0.5rem; /* Rounded corners */
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05); /* Subtle shadow */
            padding: 0.25rem; /* Small internal padding */
            margin-bottom: 0.25rem; /* Space between stacked classes */
            font-size: 0.75rem; /* Small font size for dense information */
            line-height: 1rem;
            color: #1f2937; /* Dark gray text color */
            word-break: break-all; /* Break long words to fit in cell */
            overflow: hidden; /* Hide overflowing content */
        }
        /* Media query for smaller screens (e.g., mobile) */
        @media (max-width: 768px) {
            table {
                min-width: 1000px; /* Slightly smaller minimum width for mobile */
            }
            th, td {
                padding: 6px; /* Reduced padding */
            }
            .time-slot-header, .time-slot-cell {
                min-width: 70px; /* Reduced minimum width for time slots */
            }
        }
    </style>
</head>
<body class="bg-gray-100 p-4 sm:p-6">
    <div class="max-w-full mx-auto bg-white rounded-lg shadow-xl overflow-hidden">
        <!-- Header section of the timetable -->
        <div class="p-4 sm:p-6 bg-blue-600 text-white rounded-t-lg">
            <h1 class="text-2xl sm:text-3xl font-bold text-center">ICT Aug 2025</h1>
            <p class="text-center text-blue-100 mt-1">Class time table for ICT student Aug 2025.</p>
        </div>

        <!-- Main timetable container with horizontal scrolling -->
        <div class="timetable-container">
            <table class="w-full text-sm text-left text-gray-500">
                <thead class="text-xs text-gray-700 uppercase bg-gray-50">
                    <tr>
                        <!-- Day column header - sticky to the left -->
                        <th scope="col" class="sticky left-0 px-2 py-3 border-r border-gray-200 z-20 bg-gray-50 min-w-[80px]">Day</th>
                        <!-- Time slot headers will be dynamically inserted here by JavaScript -->
                    </tr>
                </thead>
                <tbody>
                    <!-- Timetable rows and cells will be dynamically inserted here by JavaScript -->
                </tbody>
            </table>
        </div>
        <!-- Footer section -->
        <div class="p-4 sm:p-6 bg-gray-50 text-gray-600 text-center text-xs rounded-b-lg">
            <p>Generated Timetable - Data as of August 2025</p>
        </div>
    </div>

    <script>
        // Define the raw class data provided by the user
        const classData = [
            {
                code: "AT70.03",
                name: "Theory of Computation",
                instructor: "Prof. Dung",
                times: [
                    { day: "Monday", start: "14:30", end: "16:00" },
                    { day: "Tuesday", start: "14:30", end: "16:00" },
                ],
                classroom: "CS 106",
                zoom: "Meeting ID - 492 603 4006, Passcode: 256512",
                startDate: "18 August 2025",
            },
            {
                code: "AT70.05",
                name: "Computer Networks",
                instructor: "Dr. Sukumal",
                times: [{ day: "Wednesday", start: "13:00", end: "16:00" }],
                classroom: "W 216",
                startDate: "13 August 2025",
            },
            {
                code: "AT70.25",
                name: "Full Stack Application Development",
                instructor: "Dr. Chantri",
                times: [
                    { day: "Thursday", start: "09:00", end: "11:00", type: "Lecture" },
                    { day: "Friday", start: "09:00", end: "12:00", type: "Lab" },
                ],
                classroom: "W 202",
                startDate: "14 August 2025",
            },
            {
                code: "AT71.03",
                name: "E-Business Development and Technology",
                instructor: "Dr. Vatcharaporn",
                times: [{ day: "Thursday", start: "13:00", end: "16:00" }],
                classroom: "W 202",
                startDate: "14 August 2025",
            },
            {
                code: "AT82.01",
                name: "Computer Programming for Data Science and Artificial Intelligence",
                instructor: "Dr. Chantri",
                times: [
                    { day: "Tuesday", start: "09:00", end: "12:00" },
                    { day: "Tuesday", start: "14:30", end: "17:30" },
                ],
                classroom: "W 202",
                startDate: "19 August 2025",
                remark: "This course is offered for DSAI students only.",
            },
            {
                code: "AT82.02",
                name: "Data Modeling and Management",
                instructor: "Dr. Chutiporn/Dr. Kantinee",
                times: [
                    { day: "Tuesday", start: "09:30", end: "11:30" },
                    { day: "Thursday", start: "17:30", end: "20:00" },
                ],
                classroom: "Online",
                startDate: "14 August 2025",
                remark: "This course is not for DSAI August 2025 intake.",
            },
            {
                code: "AT82.03",
                name: "Machine Learning",
                instructor: "Dr. Chaklam",
                times: [
                    { day: "Monday", start: "09:00", end: "12:00" },
                    { day: "Wednesday", start: "09:00", end: "12:00" },
                ],
                classroom: "TC 101",
                startDate: "13 August 2025",
            },
            {
                code: "AT82.07",
                name: "Artificial Intelligence: Knowledge Representation and Reasoning",
                instructor: "Prof. Dung",
                times: [
                    { day: "Monday", start: "13:00", end: "14:30" },
                    { day: "Tuesday", start: "13:00", end: "14:30" },
                ],
                classroom: "TC 103",
                startDate: "18 August 2025",
            },
            {
                code: "AT82.08",
                name: "Computer Vision",
                instructor: "Dr. Cherdsak",
                times: [{ day: "Saturday", start: "09:00", end: "12:00" }],
                classroom: "TC 103",
                startDate: "16 August 2025",
            },
            {
                code: "AT82.09",
                name: "Human-Computer Interaction and Information Visualization",
                instructor: "Dr. Chaklam",
                times: [{ day: "Thursday", start: "09:00", end: "12:00" }],
                classroom: "TC 201",
                startDate: "14 August 2025",
            },
            {
                code: "AT76.01",
                name: "Geographic Information Systems",
                instructor: "Prof. Nitin",
                times: [
                    { day: "Friday", start: "10:00", end: "12:00", type: "Lecture" },
                    { day: "Friday", start: "13:00", end: "16:00", type: "Lab" },
                ],
                classroom: "TC 201",
                startDate: "15 August 2025",
            },
            {
                code: "AT76.03",
                name: "Remote Sensing",
                instructor: "Dr. Virdis",
                times: [
                    { day: "Thursday", start: "10:00", end: "12:00", type: "Lecture" },
                    { day: "Thursday", start: "13:00", end: "16:00", type: "Lab" },
                ],
                classroom: "TC 201",
                startDate: "14 August 2025",
            },
            {
                code: "AT76.22",
                name: "Web GIS Technology",
                instructor: "Dr. Sarawut",
                times: [
                    { day: "Tuesday", start: "10:00", end: "12:00", type: "Lecture" },
                    { day: "Tuesday", start: "13:00", end: "16:00", type: "Lab" },
                ],
                classroom: "TC 103",
                startDate: "19 August 2025",
            },
            {
                code: "AT76.29",
                name: "Positioning and Location-Based Services Technology",
                instructor: "Dr. Sarawut",
                times: [{ day: "Tuesday", start: "09:00", end: "12:00", type: "Lecture" }],
                classroom: "TC 103",
                startDate: "October 2025",
            },
            {
                code: "AT76.9023",
                name: "Selected Topic: GIS for Health",
                instructor: "Prof. Nitin",
                times: [{ day: "Wednesday", start: "10:00", end: "12:00" }],
                classroom: "TC 101",
                startDate: "20 August 2025",
            },
            {
                code: "AT76.9029",
                name: "Selected Topic: Introduction to Global Navigation Satellite Systems",
                instructor: "Dr. Sanit",
                times: [{ day: "Monday", start: "09:00", end: "12:00" }],
                classroom: "CS 106",
                startDate: "October 2025",
            },
            {
                code: "AT76.9044",
                name: "Selected Topic: Introduction to Python",
                instructor: "Dr. Virdis",
                times: [
                    { day: "Monday", start: "10:00", end: "12:00" },
                    { day: "Friday", start: "09:00", end: "12:00" },
                ],
                classroom: "CS 106",
                startDate: "18 August 2025",
            },
            {
                code: "AT77.02",
                name: "Signal, Systems and Stochastic Processes",
                instructor: "Prof. Attaphongse",
                times: [
                    { day: "Wednesday", start: "10:30", end: "12:30" },
                    { day: "Friday", start: "13:00", end: "16:00", type: "Lab" },
                ],
                classroom: "CS 210",
                startDate: "20 August 2025",
            },
            {
                code: "AT77.04",
                name: "Data Communications",
                instructor: "Dr. Teerapat",
                times: [
                    { day: "Tuesday", start: "10:30", end: "12:00" },
                    { day: "Tuesday", start: "13:30", end: "15:00" },
                ],
                classroom: "CS 210",
                startDate: "19 August 2025",
            },
            {
                code: "AT77.19",
                name: "Optimization for Communications and Networks",
                instructor: "Dr. Poompat",
                times: [
                    { day: "Monday", start: "09:00", end: "10:30" },
                    { day: "Wednesday", start: "09:00", end: "10:30" },
                ],
                classroom: "CS 210",
                startDate: "13 August 2025",
            },
            {
                code: "AT80.01",
                name: "Information and Communication Technology Applications: Users and Producers",
                instructor: "Dr. Teerawat",
                times: [
                    { day: "Monday", start: "18:00", end: "21:00" },
                    { day: "Saturday", start: "09:00", end: "12:00" },
                ],
                classroom: "CS 209",
                startDate: "11 August 2025",
            },
            {
                code: "AT83.02",
                name: "Wireless Technologies for Internet of Things",
                instructor: "Prof. Attaphongse",
                times: [
                    { day: "Thursday", start: "09:00", end: "12:00" },
                    { day: "Thursday", start: "13:00", end: "16:00", type: "Lab" },
                ],
                classroom: "E 233",
                startDate: "21 August 2025",
            },
            {
                code: "AT83.9002",
                name: "Selected Topic: Industrial IoT: Machine Development and Industrial Application",
                instructor: "Dr. Sanit, Mr. Piyawat",
                times: [
                    { day: "Friday", start: "09:00", end: "12:00" },
                    { day: "Friday", start: "13:00", end: "16:00", type: "Lab" },
                ],
                classroom: "E 233",
                startDate: "15 August 2025",
            },
        ];

        // Helper function to convert a time string (e.g., "09:30") to minutes from midnight
        function timeToMinutes(timeStr) {
            const [hours, minutes] = timeStr.split(':').map(Number);
            return hours * 60 + minutes;
        }

        // Helper function to convert minutes from midnight back to a time string (e.g., "09:30")
        function minutesToTime(minutes) {
            const hours = Math.floor(minutes / 60);
            const mins = minutes % 60;
            return `${String(hours).padStart(2, '0')}:${String(mins).padStart(2, '0')}`;
        }

        // Assign a distinct background color to each unique class code
        const classColors = {};
        // A predefined array of distinct colors to ensure good visual separation
        const distinctColors = [
            '#FFADAD', '#FFD6A5', '#FDFFB6', '#CAFFBF', '#9BF6FF',
            '#A0C4FF', '#BDB2FF', '#FFC6FF', '#FFFFFC', '#E0BBE4',
            '#957DAD', '#D291BC', '#FFC72C', '#F28F3B', '#D64045',
            '#A1D2CE', '#68BBE3', '#3E8AD6', '#1A535C', '#4ECDC4',
            '#F7FFF7', '#FF6B6B', '#FFE66D', '#C7F2A4', '#8DCCAD',
            '#5D8B7E', '#4A6D7C', '#34495E', '#2C3E50', '#7F8C8D'
        ];
        let colorIndex = 0;
        classData.forEach(cls => {
            if (!classColors[cls.code]) {
                classColors[cls.code] = distinctColors[colorIndex % distinctColors.length];
                colorIndex++;
            }
        });

        // Determine the overall earliest and latest class times to define the timetable's time range
        let minTime = 24 * 60; // Initialize with max possible minutes (midnight)
        let maxTime = 0; // Initialize with min possible minutes (midnight)

        classData.forEach(cls => {
            cls.times.forEach(timeSlot => {
                const startMinutes = timeToMinutes(timeSlot.start);
                const endMinutes = timeToMinutes(timeSlot.end);
                minTime = Math.min(minTime, startMinutes); // Find the earliest start time
                maxTime = Math.max(maxTime, endMinutes);   // Find the latest end time
            });
        });

        // Adjust minTime to the nearest lower 30-minute interval
        minTime = Math.floor(minTime / 30) * 30;
        // Adjust maxTime to the nearest higher 30-minute interval
        maxTime = Math.ceil(maxTime / 30) * 30;

        // Generate an array of 30-minute time slots for the table columns
        const timeSlots = [];
        for (let i = minTime; i < maxTime; i += 30) {
            timeSlots.push(i);
        }

        // Define the order of days for the table rows
        const daysOfWeek = ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"];

        // Initialize the timetable grid. Each slot will store an object with:
        // - `classes`: an array of classes that *start* at this specific 30-minute slot.
        // - `isSpanned`: a boolean indicating if this slot is covered by a colspan from an earlier class.
        const timetableGrid = {};
        daysOfWeek.forEach(day => {
            timetableGrid[day] = {};
            timeSlots.forEach(slot => {
                timetableGrid[day][slot] = {
                    classes: [],
                    isSpanned: false
                };
            });
        });

        // Populate the timetable grid with class data, marking start points and spans.
        // A class is added to the 'classes' array only at its starting 30-minute slot.
        // Subsequent 30-minute slots covered by the class are marked with `isSpanned: true`.
        classData.forEach(cls => {
            cls.times.forEach(timeSlot => {
                const day = timeSlot.day;
                const startMinutes = timeToMinutes(timeSlot.start);
                const endMinutes = timeToMinutes(timeSlot.end);

                // Ensure the day and start time slot exist in the grid
                if (timetableGrid[day] && timetableGrid[day][startMinutes] !== undefined) {
                    // Add the class to the 'classes' array of its starting slot
                    timetableGrid[day][startMinutes].classes.push({
                        ...cls, // Copy all class properties
                        displayType: timeSlot.type || '', // 'Lecture', 'Lab', or empty string
                        actualStart: timeSlot.start,      // Store original start time for display
                        actualEnd: timeSlot.end           // Store original end time for display
                    });

                    // Mark all subsequent 30-minute slots covered by this class as 'spanned'
                    // This prevents these slots from rendering their own <td> elements,
                    // as they will be covered by the colspan of the starting <td>.
                    for (let i = startMinutes + 30; i < endMinutes; i += 30) {
                        const spannedSlotMinutes = Math.floor(i / 30) * 30;
                        if (timetableGrid[day] && timetableGrid[day][spannedSlotMinutes] !== undefined) {
                            timetableGrid[day][spannedSlotMinutes].isSpanned = true;
                        }
                    }
                }
            });
        });

        // Get references to the table body and header row elements
        const tbody = document.querySelector('tbody');
        const theadRow = document.querySelector('thead tr');

        // Dynamically render the table header (time slots)
        let dynamicHeaderHtml = `<th scope="col" class="sticky left-0 px-2 py-3 border-r border-gray-200 z-20 bg-gray-50 min-w-[80px]">Day</th>`;
        dynamicHeaderHtml += timeSlots.map(slot => `<th scope="col" class="px-2 py-3 border-r border-gray-200 text-center time-slot-header">${minutesToTime(slot)}</th>`).join('');
        theadRow.innerHTML = dynamicHeaderHtml;

        // Dynamically render the table rows (days and classes)
        let dynamicTableRowsHtml = '';
        daysOfWeek.forEach(day => {
            dynamicTableRowsHtml += `
            <tr class="border-b border-gray-200">
                <td class="sticky left-0 bg-white p-2 text-center font-semibold text-gray-700 border-r border-gray-200 min-w-[80px] z-10">${day}</td>
            `;
            let currentSlotIndex = 0; // Tracks the current 30-minute slot being processed in `timeSlots` array

            // Iterate through the time slots for the current day
            while (currentSlotIndex < timeSlots.length) {
                const currentSlotMinutes = timeSlots[currentSlotIndex];
                const slotData = timetableGrid[day][currentSlotMinutes];

                // Check if this slot is marked as spanned by a class that started earlier.
                // If true, we skip rendering a <td> for this slot as it's already covered by a previous colspan.
                if (slotData && slotData.isSpanned) {
                    currentSlotIndex++; // Move to the next 30-minute slot
                    continue; // Skip the rest of the loop for this iteration
                }

                // If not spanned, this slot is either empty or a starting point for one or more classes.
                const classesStartingHere = slotData ? slotData.classes : [];

                if (classesStartingHere.length > 0) {
                    // One or more classes start at this exact time slot.
                    // Calculate the maximum span needed for this <td> element.
                    // This span will cover the longest duration among all classes starting at this slot.
                    let maxSpan = 1; // Default span is 1 (for a 30-minute slot)
                    classesStartingHere.forEach(cls => {
                        const classDurationMinutes = timeToMinutes(cls.actualEnd) - timeToMinutes(cls.actualStart);
                        const currentClassSpan = classDurationMinutes / 30;
                        maxSpan = Math.max(maxSpan, currentClassSpan);
                    });

                    // Render a <td> element with the calculated colspan.
                    // All classes starting at this time will be stacked inside this single <td>.
                    dynamicTableRowsHtml += `<td class="p-1 border-r border-gray-200 align-top relative" colspan="${maxSpan}">`;
                    
                    // Render each class that starts at this slot, stacked vertically.
                    classesStartingHere.forEach(cls => {
                        const classColor = classColors[cls.code]; // Get the unique color for the class
                        dynamicTableRowsHtml += `
                        <div style="background-color: ${classColor};" class="rounded-lg shadow-sm p-1 mb-1 text-xs text-gray-800 break-words overflow-hidden">
                            <strong class="font-bold">${cls.code}</strong><br>
                            ${cls.name} ${cls.displayType ? `(${cls.displayType})` : ''}<br>
                            <span class="text-gray-700">${cls.actualStart} - ${cls.actualEnd}</span><br>
                            <span class="text-gray-600">${cls.classroom}</span><br>
                            <span class="text-gray-600"><strong>Instructor:</strong> ${cls.instructor}</span><br>
                            ${cls.remark ? `<span class="text-red-700"><strong>Remark:</strong> ${cls.remark}</span><br>` : ''}
                            <span class="text-gray-600"><strong>Start:</strong> ${cls.startDate}</span><br>
                            ${cls.zoom ? `<span class="text-blue-700"><strong>Zoom:</strong> ${cls.zoom}</span>` : ''}
                        </div>
                        `;
                    });
                    dynamicTableRowsHtml += `</td>`;
                    
                    // Advance the currentSlotIndex by the calculated span.
                    // This effectively skips the 30-minute slots that are now covered by the colspan.
                    currentSlotIndex += maxSpan;
                } else {
                    // This is an empty 30-minute slot (no classes starting here, and not spanned).
                    dynamicTableRowsHtml += `<td class="p-1 border-r border-gray-200 align-top relative"></td>`;
                    currentSlotIndex++; // Move to the next 30-minute slot
                }
            }
            dynamicTableRowsHtml += `</tr>`;
        });
        tbody.innerHTML = dynamicTableRowsHtml;
    </script>
</body>
</html>
